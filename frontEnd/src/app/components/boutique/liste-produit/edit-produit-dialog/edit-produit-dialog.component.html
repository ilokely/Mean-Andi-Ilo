<h2 mat-dialog-title>
  <mat-icon>edit</mat-icon>
  Modifier le produit
</h2>

<mat-dialog-content>
  <form [formGroup]="produitForm" class="form-edit-produit">
    <table class="table-full-width" cellspacing="0">
      <tr>
        <td>
          <mat-form-field>
            <mat-label>Nom du produit</mat-label>
            <input matInput formControlName="nom" required>
            @if (produitForm.get('nom')?.hasError('required')) {
              <mat-error>Le nom est requis</mat-error>
            }
          </mat-form-field>
        </td>
        <td>
          <mat-form-field>
            <mat-label>Marque</mat-label>
            <input matInput formControlName="marque">
          </mat-form-field>
        </td>
      </tr>

      <tr>
        <td>
          <mat-form-field>
            <mat-label>Catégorie</mat-label>
            <mat-select formControlName="categorieId" required>
              @for (categorie of categories; track categorie._id) {
                <mat-option [value]="categorie._id">
                  {{ categorie.libelle }}
                </mat-option>
              }
            </mat-select>
            @if (produitForm.get('categorieId')?.hasError('required')) {
              <mat-error>La catégorie est requise</mat-error>
            }
          </mat-form-field>
        </td>
        <td>
          <mat-form-field>
            <mat-label>Prix de vente</mat-label>
            <input matInput 
                   type="number"
                   formControlName="prix"
                   required
                   min="0"
                   step="0.01">
            @if (produitForm.get('prix')?.hasError('required')) {
              <mat-error>Le prix est requis</mat-error>
            }
          </mat-form-field>
        </td>
      </tr>

      <tr>
        <td>
          <mat-form-field>
            <mat-label>Description</mat-label>
            <textarea matInput 
                      formControlName="description"
                      rows="3"></textarea>
          </mat-form-field>
        </td>
        <td>
          <mat-form-field>
            <mat-label>Devise</mat-label>
            <mat-select formControlName="devise" required>
              <mat-option value="USD">Dollar (USD)</mat-option>
              <mat-option value="EUR">Euro (EUR)</mat-option>
              <mat-option value="JPY">Yen (JPY)</mat-option>
              <mat-option value="MGA">Ariary (MGA)</mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </tr>
    </table>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button 
          type="button"
          (click)="onCancel()">
    Annuler
  </button>

  <button mat-flat-button 
          color="primary"
          type="button"
          (click)="onSubmit()"
          [disabled]="produitForm.invalid || isLoading">
    @if (isLoading) {
      <mat-spinner diameter="20"></mat-spinner>
    }
    @if (!isLoading) {
      <span>Enregistrer</span>
    }
  </button>
</mat-dialog-actions>